import{r as u,e as h,j as o,m as g,R as Q,C as j}from"./vendor.d82eab52.js";import{s as X}from"./index.dce2a926.js";import{w as R}from"./wordTool.a5d54c1e.js";import{R as P,T as Y}from"./ReloadBtn.97222969.js";const N=32,Z=8,x=a=>Array.from(a.children),V=a=>{const S=u.exports.useRef(null),i=u.exports.useRef(null),K=u.exports.useRef(null),E=u.exports.useRef(R.getWords(a.$state.root.wordsMode,a.$state.root.customerWords)),p=u.exports.useRef([0,0]),l=u.exports.useRef({wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}}),[O,y]=u.exports.useState(!1),[D,T]=u.exports.useState(!1),[z,v]=u.exports.useState(!1),[b,A]=u.exports.useState(!1),[m,$]=u.exports.useState(""),[d,W]=u.exports.useState([]),[I,M]=u.exports.useState({top:0,left:0}),[B,G]=u.exports.useState(30),k=()=>{const r=p.current,t=i.current.getBoundingClientRect(),e=x(i.current)[r[0]];if(!e)return;const s=Array.from(e.getElementsByClassName("letter"));if(s.length<=r[1]){const n=s[r[1]-1].getBoundingClientRect();M({top:n.top-t.top+2,left:n.left-t.left+n.width})}else{const n=s[r[1]].getBoundingClientRect();M({top:n.top-t.top+2,left:n.left-t.left})}},U=u.exports.useCallback((r,t)=>{const e=p.current,s=m===""||m.charAt(m.length-1)===" ";let n;if(r===N)s?n=e:n=[e[0]+1,0];else{if(e[1]>=d[e[0]].letterArr.length){const c=x(i.current)[e[0]],f=document.createElement("code");f.className="letter wrong extra-letter",f.innerText=t,c.appendChild(f)}n=[e[0],e[1]+1]}p.current=n,k(),W(c=>{const f=c[e[0]].letterArr[e[1]];if(f&&r!==N&&(f.isCorrect=t===f.letter,c[e[0]].letterArr[e[1]]=f),r===N&&!s)if(c[e[0]].letterArr.some(C=>C.isCorrect===null))c[e[0]].isSkip=!0,c[e[0]].isCorrect=!1;else{const L=x(i.current)[e[0]].getElementsByClassName("extra-letter");!L||L.length===0?c[e[0]].isCorrect=c[e[0]].letterArr.every(J=>J.isCorrect):c[e[0]].isCorrect=!1}return(n[0]>c.length-1||e[0]===c.length-1&&e[1]===c[e[0]].letterArr.length-1)&&(c[e[0]].isCorrect=c[e[0]].letterArr.every(C=>C.isCorrect),l.current.right=c.filter(C=>C.isCorrect).length,l.current.wrong=c.length-l.current.right,l.current.acc=Math.round(l.current.right/(l.current.right+l.current.wrong)*100),l.current.time.secs=Math.round((Date.now()-l.current.time.begin)/1e3),l.current.wpm=(l.current.right/(l.current.time.secs/60)).toFixed(2),y(!1),v(!0),setTimeout(()=>{A(!0)},150)),c}),$(c=>r===N&&(c===""||c.charAt(c.length-1)===" ")?c:c+t)},[m,d]),q=u.exports.useCallback(()=>{const r=m.charAt(m.length-1);if(r==="")return;const t=p.current;let e;if(r===" ")if(d[t[0]-1].isCorrect)e=t;else if(d[t[0]-1].isSkip){const s=d[t[0]-1].letterArr.findIndex(n=>n.isCorrect===null);e=[t[0]-1,s]}else{const n=x(i.current)[t[0]-1].getElementsByClassName("letter");e=[t[0]-1,n.length]}else{const s=x(i.current)[t[0]],n=s.getElementsByClassName("extra-letter");n&&n.length>0&&s.removeChild(n[n.length-1]),e=[t[0],t[1]-1]}p.current=e,k(),W(s=>(r===" "?s[t[0]-1].isCorrect===!1&&(s[t[0]-1].isCorrect=null):s[t[0]].letterArr.length>=t[1]&&(s[t[0]].letterArr[t[1]-1].isCorrect=null,s[t[0]].isCorrect=null),s)),$(s=>{let n=!0;return r===" "&&d[t[0]-1].isCorrect&&(n=!1),n?s.substring(0,s.length-1):s})},[m,d]),H=r=>{r.keyCode!==9&&(r.preventDefault(),r.stopPropagation(),r.persist()),!b&&(T(!1),r.key.length===1?(l.current.time.begin===0&&(l.current.time.begin=Date.now()),U(r.keyCode,r.key)):r.keyCode===Z&&q())},w=()=>{y(!0),S.current.focus()},F=u.exports.useCallback(()=>{p.current=[0,0],E.current=R.shuffle(E.current),l.current={wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}};const r=i.current.getElementsByClassName("extra-letter");r.length!==0&&Array.from(r).forEach(t=>{t.parentNode.removeChild(t)}),W(R.jsonCopy(E.current.slice(0,B)).map(t=>Object.assign({},t,{letterArr:Array.from(t.text).map(e=>({letter:e,isCorrect:null})),isCorrect:null,isSkip:!1}))),$(""),v(!1),A(!1),setTimeout(()=>{w(),k()},10)},[B]);return u.exports.useEffect(()=>{E.current=R.getWords(a.$state.root.wordsMode,a.$state.root.customerWords),F()},[a.$state.root.wordsMode,a.$state.root.customerWords,F,B]),h("div",{className:"Monkey",children:[o("div",{className:"word-count-radio",children:h(g.Group,{value:B,size:"small",onChange:r=>{G(r.target.value)},children:[o(g.Button,{tabIndex:-1,value:20,children:"20"}),o(g.Button,{tabIndex:-1,value:30,children:"30"}),o(g.Button,{tabIndex:-1,value:40,children:"40"}),o(g.Button,{tabIndex:-1,value:50,children:"50"})]})}),h(Q,{justify:"center",align:"middle",children:[h(j,{flex:"900px",className:`type-main-box ${z?"fading":""} ${b?"hide":""}`,children:[o("div",{className:`caret ${O?D?"flash":"":"hide"}`,ref:K,style:{transform:`translate3d(${I.left}px,${I.top}px,0)`}}),o("div",{className:"words-box",onClick:w,ref:i,children:d.map((r,t)=>{var e;return h("div",{className:`word ${r.isCorrect?"correct":r.isCorrect===!1?"wrong":""}`,children:[o("div",{className:"label",children:r.label}),(e=r.letterArr)==null?void 0:e.map((s,n)=>o("code",{className:`letter ${s.isCorrect?"correct":s.isCorrect===!1?"wrong":""}`,children:s.letter},`${t}_${n}`))]},t)})}),o("input",{className:"hidden-input",type:"text",ref:S,onKeyDown:H,onBlur:()=>{y(!1)},onFocus:()=>{y(!0),T(!0)}}),o("div",{className:"reload-line",children:o(P,{onClick:F})}),h("div",{className:`tip-line ${D?"":"hide"}`,children:[o("div",{children:"\u70B9\u51FB\u8BCD\u5757\u8FDB\u5165\u8F93\u5165\u72B6\u6001"}),o("div",{children:"\u8F93\u5165\u6B63\u786E\u7684\u62FC\u97F3\u5B57\u6BCD\uFF0C\u7136\u540E\u7A7A\u683C"}),h("div",{children:["\u8F93\u5165\u72B6\u6001\u4E0B",o("code",{children:"Tab"}),"\u540E\u56DE\u8F66\u53EF\u4EE5\u76F4\u63A5\u5237\u65B0"]}),o("div",{children:"\u89C9\u5F97\u6709\u610F\u601D\u53EF\u4EE5\u6253\u8D4F\u4E00\u4E0B(#^.^#)(\u5728\u4E0A\u9762\u2191\u2191)"})]})]}),h(j,{flex:"900px",className:`type-result-box ${b?"show":""}`,children:[o(Y,{desc:"WPM",numStr:l.current.wpm,acc:l.current.acc,secs:l.current.time.secs}),o("div",{className:"reload-line",children:o(P,{onClick:F})})]})]})]})};var se=X(V);export{se as default};
