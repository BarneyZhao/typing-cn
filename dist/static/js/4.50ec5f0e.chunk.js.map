{"version":3,"sources":["utils/wordTool.ts","../node_modules/@ant-design/icons-svg/es/asn/ReloadOutlined.js","../node_modules/@ant-design/icons/es/icons/ReloadOutlined.js","views/monkey/Monkey.tsx"],"names":["wordTool","shuffle","arr","i","length","rIndex","Math","floor","random","temp","getWords","mode","propWords","jsonCopy","WORDS","obj","JSON","parse","stringify","ReloadOutlined","props","ref","React","AntdIcon","Object","assign","icon","ReloadOutlinedSvg","displayName","storeConnect","inputEl","useRef","mainEl","caretElRef","wordsBaseRef","$state","root","wordsMode","customerWords","coordinateRef","typeResultRef","wpm","right","wrong","acc","time","begin","secs","useState","isTyping","setIsTyping","isCaretFlash","setIsCaretFlash","isFadingTypeMain","setIsFadingTypeMain","showTypeResult","setShowTypeResult","userInput","setUserInput","wordArr","setWordArr","top","left","caretLocation","setCaretLocation","wordCount","setWordCount","setCaret","coordinate","current","mainElRect","getBoundingClientRect","currentWordEl","Array","from","children","currentLetterArr","getElementsByClassName","letterRect","width","inputForwardFunc","useCallback","keyCode","inputVal","newCoordinate","charAt","letterArr","codeEl","document","createElement","className","innerText","appendChild","_wordArr","letterObj","isCorrect","letter","some","l","isSkip","extraLetterArr","every","filter","w","round","Date","now","toFixed","setTimeout","v","backspaceFunc","deleteChar","lIndex","findIndex","removeChild","canDelete","substring","focusToInput","focus","reloadWord","slice","map","word","text","useEffect","Group","value","size","onChange","e","target","Button","justify","align","flex","style","transform","onClick","wi","key","label","li","type","onKeyDown","evt","preventDefault","stopPropagation","persist","onBlur","onFocus","gutter","span"],"mappings":"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","file":"static/js/4.50ec5f0e.chunk.js","sourcesContent":["import WORDS, { Word } from '@/words';\n\nconst wordTool = {\n    shuffle(arr: any[]) {\n        for (let i = arr.length - 1; i >= 0; i--) {\n            let rIndex = Math.floor(Math.random() * (i + 1));\n            let temp = arr[rIndex];\n            arr[rIndex] = arr[i];\n            arr[i] = temp;\n        }\n        return arr;\n    },\n    getWords(mode: string, propWords: Word[]) {\n        if (mode !== '1' && propWords && propWords.length !== 0) {\n            return wordTool.jsonCopy<Word[]>(propWords);\n        } else {\n            return wordTool.jsonCopy<Word[]>(WORDS);\n        }\n    },\n    jsonCopy<T>(obj: object) {\n        return JSON.parse(JSON.stringify(obj)) as T;\n    },\n};\n\nexport type WordType = Word;\nexport default wordTool;\n","// This icon file is generated automatically.\n// tslint:disable\nvar ReloadOutlined = { \"name\": \"reload\", \"theme\": \"outlined\", \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z\" } }] } };\nexport default ReloadOutlined;\n","// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport ReloadOutlinedSvg from \"@ant-design/icons-svg/es/asn/ReloadOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar ReloadOutlined = function ReloadOutlined(props, ref) {\n  return React.createElement(AntdIcon, Object.assign({}, props, {\n    ref: ref,\n    icon: ReloadOutlinedSvg\n  }));\n};\n\nReloadOutlined.displayName = 'ReloadOutlined';\nexport default React.forwardRef(ReloadOutlined);","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport {\n    Row,\n    Col,\n    Button,\n    Radio,\n    // Spin,\n    // Popover,\n    // Collapse,\n    // Tag,\n} from 'antd';\nimport { ReloadOutlined } from '@ant-design/icons';\n\nimport './Monkey.less';\nimport { storeConnect, MapState, MapDispatch } from '@/store/index';\nimport wordTool, { WordType } from '@/utils/wordTool';\nimport { RadioChangeEvent } from 'antd/lib/radio';\n\ninterface LetterObj {\n    letter: string;\n    isCorrect: boolean | null;\n}\ninterface WordObj extends WordType {\n    letterArr: LetterObj[];\n    isCorrect: boolean | null;\n    isSkip: boolean;\n}\n\nconst SPACE_CODE = 32;\nconst BACKSPACE_CODE = 8;\n\nconst Monkey: React.FC<MapState & MapDispatch> = (props) => {\n    const inputEl = useRef(null);\n    const mainEl = useRef(null);\n    const caretElRef = useRef(null);\n    const wordsBaseRef = useRef(\n        wordTool.getWords(props.$state.root.wordsMode, props.$state.root.customerWords)\n    );\n    const coordinateRef = useRef([0, 0]);\n    const typeResultRef = useRef({\n        wpm: '',\n        right: 0,\n        wrong: 0,\n        acc: 0,\n        time: { begin: 0, secs: 0 },\n    });\n\n    const [isTyping, setIsTyping] = useState(false);\n    const [isCaretFlash, setIsCaretFlash] = useState(false);\n    const [isFadingTypeMain, setIsFadingTypeMain] = useState(false);\n    const [showTypeResult, setShowTypeResult] = useState(false);\n    const [userInput, setUserInput] = useState('');\n    const [wordArr, setWordArr] = useState<Array<WordObj>>([]);\n    const [caretLocation, setCaretLocation] = useState({ top: 0, left: 0 });\n    const [wordCount, setWordCount] = useState(30);\n\n    const setCaret = () => {\n        const coordinate = coordinateRef.current; // 此时坐标为下一个字母的坐标\n        const mainElRect = (mainEl.current as any).getBoundingClientRect();\n        const currentWordEl = Array.from<any>((mainEl.current as any).children)[coordinate[0]];\n        const currentLetterArr = Array.from<any>(currentWordEl.getElementsByClassName('letter'));\n        if (currentLetterArr.length <= coordinate[1]) {\n            const letterRect = currentLetterArr[coordinate[1] - 1].getBoundingClientRect();\n            setCaretLocation({\n                top: letterRect.top - mainElRect.top + 2,\n                left: letterRect.left - mainElRect.left + letterRect.width,\n            });\n        } else {\n            const letterRect = currentLetterArr[coordinate[1]].getBoundingClientRect();\n            setCaretLocation({\n                top: letterRect.top - mainElRect.top + 2,\n                left: letterRect.left - mainElRect.left,\n            });\n        }\n    };\n\n    const inputForwardFunc = useCallback(\n        (keyCode: number, inputVal: string) => {\n            const coordinate = coordinateRef.current;\n            let newCoordinate;\n            if (keyCode === SPACE_CODE) {\n                if (userInput === '' || userInput.charAt(userInput.length - 1) === ' ') {\n                    newCoordinate = coordinate;\n                } else {\n                    newCoordinate = [coordinate[0] + 1, 0];\n                }\n            } else {\n                if (coordinate[1] >= wordArr[coordinate[0]].letterArr.length) {\n                    // 已经是单词最后一位（下标等于长度），却输入了字母\n                    const currentWordEl = Array.from<any>((mainEl.current as any).children)[\n                        coordinate[0]\n                    ];\n                    const codeEl = document.createElement('code');\n                    codeEl.className = 'letter wrong extra-letter';\n                    codeEl.innerText = inputVal;\n                    currentWordEl.appendChild(codeEl);\n                }\n                newCoordinate = [coordinate[0], coordinate[1] + 1];\n            }\n            coordinateRef.current = newCoordinate;\n            setCaret();\n\n            setWordArr((_wordArr) => {\n                const letterObj = _wordArr[coordinate[0]].letterArr[coordinate[1]];\n                if (letterObj && keyCode !== SPACE_CODE) {\n                    // console.log(inputVal === letterObj.letter, letterObj);\n                    letterObj.isCorrect = inputVal === letterObj.letter;\n                    _wordArr[coordinate[0]].letterArr[coordinate[1]] = letterObj;\n                }\n                if (keyCode === SPACE_CODE) {\n                    // 是否没有输入完单词就空格跳过\n                    if (_wordArr[coordinate[0]].letterArr.some((l) => l.isCorrect === null)) {\n                        _wordArr[coordinate[0]].isSkip = true;\n                        _wordArr[coordinate[0]].isCorrect = false;\n                    } else {\n                        const currentWordEl = Array.from<any>((mainEl.current as any).children)[\n                            coordinate[0]\n                        ];\n                        const extraLetterArr = currentWordEl.getElementsByClassName('extra-letter');\n                        if (!extraLetterArr || extraLetterArr.length === 0) {\n                            _wordArr[coordinate[0]].isCorrect = _wordArr[\n                                coordinate[0]\n                            ].letterArr.every((l) => l.isCorrect);\n                        } else {\n                            _wordArr[coordinate[0]].isCorrect = false;\n                        }\n                    }\n                }\n\n                // 是否最后一个词、最后一个字母, 判断显示结果\n                if (\n                    coordinate[0] === _wordArr.length - 1 &&\n                    coordinate[1] === _wordArr[coordinate[0]].letterArr.length - 1\n                ) {\n                    const currentWordEl = Array.from<any>((mainEl.current as any).children)[\n                        coordinate[0]\n                    ];\n                    const extraLetterArr = currentWordEl.getElementsByClassName('extra-letter');\n                    if (!extraLetterArr || extraLetterArr.length === 0) {\n                        _wordArr[coordinate[0]].isCorrect = _wordArr[coordinate[0]].letterArr.every(\n                            (l) => l.isCorrect\n                        );\n                        if (_wordArr[coordinate[0]].isCorrect) {\n                            typeResultRef.current.right = _wordArr.filter(\n                                (w) => w.isCorrect\n                            ).length;\n                            typeResultRef.current.wrong =\n                                _wordArr.length - typeResultRef.current.right;\n                            typeResultRef.current.acc = Math.round(\n                                (typeResultRef.current.right /\n                                    (typeResultRef.current.right + typeResultRef.current.wrong)) *\n                                    100\n                            );\n                            typeResultRef.current.time.secs = Math.round(\n                                (Date.now() - typeResultRef.current.time.begin) / 1000\n                            );\n                            typeResultRef.current.wpm = (\n                                typeResultRef.current.right /\n                                (typeResultRef.current.time.secs / 60)\n                            ).toFixed(2);\n                            setIsTyping(false);\n                            setIsFadingTypeMain(true);\n                            setTimeout(() => {\n                                setShowTypeResult(true);\n                            }, 150);\n                        }\n                    }\n                }\n                return _wordArr;\n            });\n            setUserInput((v) => {\n                if (keyCode === SPACE_CODE && (v === '' || v.charAt(v.length - 1) === ' ')) {\n                    return v;\n                }\n                return v + inputVal;\n            });\n        },\n        [userInput, wordArr]\n    );\n    const backspaceFunc = useCallback(() => {\n        const deleteChar = userInput.charAt(userInput.length - 1);\n        if (deleteChar === '') {\n            return;\n        }\n        const coordinate = coordinateRef.current;\n        let newCoordinate;\n        if (deleteChar === ' ') {\n            if (wordArr[coordinate[0] - 1].isCorrect) {\n                newCoordinate = coordinate;\n            } else {\n                if (wordArr[coordinate[0] - 1].isSkip) {\n                    const lIndex = wordArr[coordinate[0] - 1].letterArr.findIndex(\n                        (l) => l.isCorrect === null\n                    );\n                    newCoordinate = [coordinate[0] - 1, lIndex];\n                } else {\n                    const currentWordEl = Array.from<any>((mainEl.current as any).children)[\n                        coordinate[0] - 1\n                    ];\n                    const currentLetterArr = currentWordEl.getElementsByClassName('letter');\n                    newCoordinate = [coordinate[0] - 1, currentLetterArr.length];\n                }\n            }\n        } else {\n            const currentWordEl = Array.from<any>((mainEl.current as any).children)[coordinate[0]];\n            const extraLetterArr = currentWordEl.getElementsByClassName('extra-letter');\n            if (extraLetterArr && extraLetterArr.length > 0) {\n                currentWordEl.removeChild(extraLetterArr[extraLetterArr.length - 1]);\n            }\n            newCoordinate = [coordinate[0], coordinate[1] - 1];\n        }\n        coordinateRef.current = newCoordinate;\n        setCaret();\n        setWordArr((_wordArr) => {\n            if (deleteChar === ' ') {\n                if (_wordArr[coordinate[0] - 1].isCorrect === false) {\n                    _wordArr[coordinate[0] - 1].isCorrect = null;\n                }\n            } else if (_wordArr[coordinate[0]].letterArr.length >= coordinate[1]) {\n                _wordArr[coordinate[0]].letterArr[coordinate[1] - 1].isCorrect = null;\n                _wordArr[coordinate[0]].isCorrect = null;\n            }\n            return _wordArr;\n        });\n        setUserInput((v) => {\n            let canDelete = true;\n            if (deleteChar === ' ') {\n                if (wordArr[coordinate[0] - 1].isCorrect) {\n                    canDelete = false;\n                }\n            }\n            return canDelete ? v.substring(0, v.length - 1) : v;\n        });\n    }, [userInput, wordArr]);\n\n    const inputKeyDown = (evt: React.KeyboardEvent) => {\n        // console.log(evt.key, evt.keyCode, evt.metaKey);\n        // 9: Tab\n        if (evt.keyCode !== 9) {\n            evt.preventDefault();\n            evt.stopPropagation();\n            evt.persist();\n        }\n        if (showTypeResult) {\n            return;\n        }\n        setIsCaretFlash(false);\n        if (evt.key.length === 1) {\n            if (typeResultRef.current.time.begin === 0) {\n                typeResultRef.current.time.begin = Date.now();\n            }\n            inputForwardFunc(evt.keyCode, evt.key);\n        } else if (evt.keyCode === BACKSPACE_CODE) {\n            backspaceFunc();\n        }\n    };\n\n    const focusToInput = () => {\n        setIsTyping(true);\n        (inputEl.current as any).focus();\n    };\n\n    const reloadWord = useCallback(() => {\n        coordinateRef.current = [0, 0];\n        wordsBaseRef.current = wordTool.shuffle(wordsBaseRef.current);\n        typeResultRef.current = {\n            wpm: '',\n            right: 0,\n            wrong: 0,\n            acc: 0,\n            time: { begin: 0, secs: 0 },\n        };\n        setWordArr(\n            wordTool.jsonCopy<WordType[]>(wordsBaseRef.current.slice(0, wordCount)).map((word) => {\n                return Object.assign({}, word, {\n                    letterArr: Array.from(word.text).map((letter) => ({\n                        letter,\n                        isCorrect: null,\n                    })),\n                    isCorrect: null,\n                    isSkip: false,\n                });\n            })\n        );\n        setUserInput('');\n        setIsFadingTypeMain(false);\n        setShowTypeResult(false);\n        setTimeout(() => {\n            focusToInput();\n            setCaret();\n        }, 10);\n    }, [wordCount]);\n\n    useEffect(() => {\n        reloadWord();\n    }, [reloadWord, wordCount]);\n\n    return (\n        <div className=\"Monkey\">\n            <div className=\"word-count-radio\">\n                <Radio.Group\n                    value={wordCount}\n                    size=\"small\"\n                    onChange={(e: RadioChangeEvent) => {\n                        setWordCount(e.target.value);\n                    }}\n                >\n                    <Radio.Button value={20}>20</Radio.Button>\n                    <Radio.Button value={30}>30</Radio.Button>\n                    <Radio.Button value={40}>40</Radio.Button>\n                    <Radio.Button value={50}>50</Radio.Button>\n                </Radio.Group>\n            </div>\n            <Row justify=\"center\" align=\"middle\">\n                <Col\n                    flex=\"900px\"\n                    className={`type-main-box ${isFadingTypeMain ? 'fading' : ''} ${\n                        showTypeResult ? 'hide' : ''\n                    }`}\n                >\n                    <div\n                        className={`caret ${isTyping ? (isCaretFlash ? 'flash' : '') : 'hide'}`}\n                        ref={caretElRef}\n                        style={{\n                            transform: `translate3d(${caretLocation.left}px,${caretLocation.top}px,0)`,\n                        }}\n                    ></div>\n                    <div className=\"words-box\" onClick={focusToInput} ref={mainEl}>\n                        {wordArr.map((word, wi) => (\n                            <div\n                                className={`word ${\n                                    word.isCorrect\n                                        ? 'correct'\n                                        : word.isCorrect === false\n                                        ? 'wrong'\n                                        : ''\n                                }`}\n                                key={wi}\n                            >\n                                <div className=\"label\">{word.label}</div>\n                                {word.letterArr?.map((letterObj, li) => (\n                                    <code\n                                        className={`letter ${\n                                            letterObj.isCorrect\n                                                ? 'correct'\n                                                : letterObj.isCorrect === false\n                                                ? 'wrong'\n                                                : ''\n                                        }`}\n                                        key={`${wi}_${li}`}\n                                    >\n                                        {letterObj.letter}\n                                    </code>\n                                ))}\n                            </div>\n                        ))}\n                    </div>\n                    <input\n                        className=\"hidden-input\"\n                        type=\"text\"\n                        ref={inputEl}\n                        onKeyDown={inputKeyDown}\n                        onBlur={() => {\n                            setIsTyping(false);\n                            setIsCaretFlash(false);\n                        }}\n                        onFocus={() => {\n                            setIsTyping(true);\n                            setIsCaretFlash(true);\n                        }}\n                    />\n                    <div className=\"reload-line\">\n                        <Button\n                            className=\"reload-btn\"\n                            onClick={reloadWord}\n                            type=\"primary\"\n                            icon={<ReloadOutlined />}\n                        />\n                    </div>\n                    {/* {userInput} */}\n                </Col>\n                <Col flex=\"900px\" className={`type-result-box ${showTypeResult ? 'show' : ''}`}>\n                    {/* {JSON.stringify(typeResultRef.current)} */}\n                    <div className=\"type-result\">\n                        <Row justify=\"center\" gutter={80}>\n                            <Col span={6}>\n                                <div className=\"label\">WPM</div>\n                                <div className=\"show-data\">{typeResultRef.current.wpm}</div>\n                            </Col>\n                            <Col span={6}>\n                                <div className=\"label\">正确率</div>\n                                <div className=\"show-data\">{typeResultRef.current.acc}%</div>\n                            </Col>\n                            <Col span={6}>\n                                <div className=\"label\">用时</div>\n                                <div className=\"show-data\">{typeResultRef.current.time.secs}s</div>\n                            </Col>\n                        </Row>\n                    </div>\n                    <div className=\"reload-line\">\n                        <Button\n                            className=\"reload-btn\"\n                            onClick={reloadWord}\n                            type=\"primary\"\n                            icon={<ReloadOutlined />}\n                        />\n                    </div>\n                </Col>\n            </Row>\n        </div>\n    );\n};\n\nexport default storeConnect(Monkey);\n"],"sourceRoot":""}